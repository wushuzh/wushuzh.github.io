<!DOCTYPE html>
<html lang="zh-cn">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>GitLab CE 安装</title>
<meta name="description" content="个人技术站点">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="https://wushuzh.github.io/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="https://wushuzh.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="https://wushuzh.github.io/css/owl.carousel.css">
<link rel="stylesheet" href="https://wushuzh.github.io/css/owl.theme.css">


  <link href="https://wushuzh.github.io/css/style.sea.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://wushuzh.github.io/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://wushuzh.github.io/img/favicon.png">


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-102509506-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="/">小强会武术</a></h1>
    
      <p class="sidebar-p">工程师</p>
    
      <p class="sidebar-p">记录每一个自己填平的坑</p>
    
    <ul class="sidebar-menu">
      
      
        <li><a href="https://wushuzh.github.io/">Home</a></li>
      
    </ul>
    <p class="social">
  
  
  
  <a href="https://twitter.com/Xiao_Qiang" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  <a href="mailto:wushuzh@outlook.com" data-animate-hover="pulse" class="email">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  
  

  
  <a href="https://wushuzh.github.io/index.xml" data-animate-hover="pulse">
    <i class='fa fa-rss'></i>
  </a>
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2017 wushuzh
        
        | Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="/">小强会武术</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">

      <div class="row">
        <div class="col-sm-6">
          
            <div class="image">
              <img src="https://wushuzh.github.io//img/blog/setup-a-gitlab-ce-service/lab_notebook.png" class="img-responsive" alt="">
            </div>
          
        </div>
        <div class="col-md-6">
            <h2>GitLab CE 安装</h2>
                <p>
                  小强会武术
                </p>

                <time datetime="2017-06-18 21:18:51 &#43;0800 CST">
                <i class="fa fa-calendar-o fa-fw"></i> 2017-06-18
                </time>
                &middot;
                1404 字
                &middot;
                3 分钟

        </div>
      </div>
      <br />

         <p>如何搭建 GitLab 以获得类似 GitHub 的服务
</p>

<h2 id="git-简介">Git 简介</h2>

<p>作为 Linus Torvalds 的另一个伟大发明，<a href="https://en.wikipedia.org/wiki/Git">Git</a> 应该已经成为当下最流行的源代码管理工具。它甚至被定位成一般意义上追踪文档变更或多人协同编辑的工具了。</p>

<p>使用 Git 最大开源社区是 Linux <a href="https://en.wikipedia.org/wiki/Linux_kernel">内核项目</a>，向它贡献代码的开发者的人数高达 12000 人，来自全球 1200 家公司。另一个前些日子很热的新闻是微软将 Windows 开发迁移到 Git 上，并对其做了一些定制 (如 GVFS )。其他的 Git 应用案例包括</p>

<ul>
<li>应用 git-lfs 保存较大的二进制文件;</li>
<li><a href="https://github.com/blog/1465-stl-file-viewing">查看</a>、<a href="https://github.com/blog/1633-3d-file-diffs">比较</a> CAD文件的变更历史 ( <a href="https://en.wikipedia.org/wiki/STL_(file_format)">STL</a> 格式保存 )；</li>
<li>管理法案、法律文件的<a href="https://www.quora.com/Could-Git-be-used-to-track-bills-in-Congress">探索</a>;</li>
</ul>

<p>所有的主流源代码仓库服务提供商都支持 Git。最大最知名的当属被称为编程交友平台的 GitHub (吉祥物为一只章鱼猫 )，和它类似还有 SourceForge，Bitbucket，GitLab，CodePlex, Launchpad （排名按 2017 六月 Alexa 排名）。</p>

<p><img alt="GitHub Octocat" src="/img/blog/setup-a-gitlab-ce-service/ironcat.png" class="img-responsive"></p>

<h2 id="gitlab-简介">GitLab 简介</h2>

<p><a href="https://en.wikipedia.org/wiki/GitLab">GitLab</a> 是一个基于网页的开源 Git 仓库管理器，附送代码审核、缺陷跟踪、Wiki、编译构建等附加功能。作为少数的可以自行搭建相应服务的网站，一般的开发者只要有个VPS就可以很快搭建起来。GitHub 作为付费产品，当然也有所有这些服务，但通常你要注册为其付费会员(每月7美元)</p>

<p>关于 GitLab 的新特性，其官网上有<a href="https://youtu.be/PoBaY_rqeKA">介绍视频</a>：作者在短短十分钟内，演示了利用 GitLab 9 完成如下事项</p>

<ol>
<li>创建一个工作组，在其下创建(导入)一个实例项目</li>
<li>设定基于 Mattermost (一个可自行搭建的类似 slack 的聊天协作工具)的自动集成部署</li>
<li>在 Mattermost 内和组员讨论后，形成更改项目的新决议</li>
<li>在 Mattermost 内通过 GitLab 机器人直接创建一个 issue</li>
<li>从 Mattermost 导航到项目 issue 页，通过看板，将此 issue 从 Todo 转到 Doing 状态</li>
<li>通过 GitLab 的内置终端，直接访问部署环境</li>
<li>通过 GitLab 的网页端编辑器，创建新分支，并将新的提交合并到主分支（并关闭 issue， 删除临时分支）</li>
<li>GitLab 自动触发自动部署，在其他团队成员审阅代码前，就开始了新代码的部署，这样审核代码时，就可以查看部署是否成功，并导航到新部署容器上查看改成后的界面……</li>
<li>当分支真正被接受合并后，又一次触发了主分支上的自动集成，自动部署到待命区服务器 (staging server)</li>
<li>之后从 Mattermost 通过 Bot 触发从待命区部署到生产环境，如果生产环境是集群，这里还可以看到当前部署到第几个实例了</li>
<li>另外，你还可以直接查看部署服务器的负荷的曲线图，回看总结本次“从产生想法到做最终部署”各阶段所用的时间</li>
</ol>

<p>
<figure >
    
        <img src="/img/blog/setup-a-gitlab-ce-service/gitlab-pages.png" />
    
    
    <figcaption>
        <h4>GitLab Pages</h4>
        
    </figcaption>
    
</figure>


<figure >
    
        <img src="/img/blog/setup-a-gitlab-ce-service/gitlab-issues.png" />
    
    
    <figcaption>
        <h4>GitLab Issues</h4>
        
    </figcaption>
    
</figure>


<figure >
    
        <img src="/img/blog/setup-a-gitlab-ce-service/gitlab-issue-board.png" />
    
    
    <figcaption>
        <h4>GitLab Issues Board</h4>
        
    </figcaption>
    
</figure>


<figure >
    
        <img src="/img/blog/setup-a-gitlab-ce-service/gitlab-merge-conflicts.png" />
    
    
    <figcaption>
        <h4>GitLab Merge</h4>
        
    </figcaption>
    
</figure>


<figure >
    
        <img src="/img/blog/setup-a-gitlab-ce-service/gitlab-review-apps.png" />
    
    
    <figcaption>
        <h4>GitLab Review</h4>
        
    </figcaption>
    
</figure>


<figure >
    
        <img src="/img/blog/setup-a-gitlab-ce-service/gitlab-pipelines.png" />
    
    
    <figcaption>
        <h4>GitLab Pipeline</h4>
        
    </figcaption>
    
</figure>


<figure >
    
        <img src="/img/blog/setup-a-gitlab-ce-service/gitlab-cycle-analytics.png" />
    
    
    <figcaption>
        <h4>GitLab Analysis</h4>
        
    </figcaption>
    
</figure>
</p>

<p>这么梦幻的一个工作流，一分钱不用花自己折腾一下就可以拥有，心动就参考下文开始行动吧</p>

<h2 id="安装过程">安装过程</h2>

<p>网上普遍都是<a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-gitlab-on-ubuntu-16-04">基于 Ubuntu 的安装指南</a>，那就按照最普遍的系统进行实践：</p>


<figure >
    
        <img src="/img/blog/setup-a-gitlab-ce-service/ubuntu-16-04-xenial-xerus-squirrel.jpg" />
    
    
    <figcaption>
        <h4>Ubuntu 1604 LTS</h4>
        
    </figcaption>
    
</figure>


<ol>
<li>所有步骤都建议再 tmux 中执行，以免网络抖动后悲剧</li>
<li>Ubuntu 推荐版本 16.04 LTS Xerus</li>
<li>配置 GitLab deb 源并安装最新安装包</li>
<li>执行 GitLab 初始配置</li>
<li>设置防火墙对 SSH 和 HTTP 链接开放</li>
<li>登录网页，设定密码，管理员身份设定，是否全部或对某域名邮箱开发注册等等</li>
<li>如果你有自己的域名，通过 Let&rsquo;s Encrypt 设定 HTTPS(<a href="https://www.digitalocean.com/community/tutorials/how-to-secure-gitlab-with-let-s-encrypt-on-ubuntu-16-04">https://www.digitalocean.com/community/tutorials/how-to-secure-gitlab-with-let-s-encrypt-on-ubuntu-16-04</a>)</li>
<li>Enjoy</li>
</ol>

<p>我自己提交代码都用 SSH，就没搞 HTTPS</p>

<p><img alt="Welcome to GitLab" src="/img/blog/setup-a-gitlab-ce-service/fox-snow.gif" class="img-responsive"></p>

<p>缩略语解释</p>

<blockquote>
<ul>
<li>GVFS：Git Virtual File System</li>
<li>Xerus: 仅存于非洲的地松鼠亚科，注意不要和南非狐獴弄混，前者属于啮齿目，后者属于食肉目，除了昆虫，有时候会吃蜥蜴，蛇，蝎子什么的</li>
<li>Mattermost: 一个同样可以自行搭建的类似 slack 提供团队协作的云交流工具，但新增了不少企业级的特色功能，比如查看诸如关于配置变更，登录，用户行为等各类服务器日志，数据的合规访问，各式CI和CD集成操作。其客户有 Redhat、Intel、Mozilla、Sumsung 等等</li>
</ul>
</blockquote>

<p>参考文档</p>

<blockquote>
<ul>
<li>Justin E.(2016-10-14). <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-gitlab-on-ubuntu-16-04">How To Install and Configure GitLab on Ubuntu 16.04.</a></li>
<li>Mitchell A.(2016-04-21) <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-16-04">initial-server-setup-with-ubuntu-16.04</a></li>
<li><a href="https://explainxkcd.com/wiki/index.php/1597:_Git">https://explainxkcd.com/wiki/index.php/1597:_Git</a></li>
</ul>
</blockquote>

<p>文中图片来源网络
GitLab 吉祥物是一个抽象的 “貉”/“狸”脸，但我觉的如果能请来 Megan Fox 为其代言，一定会大获成功

<figure >
    
        <img src="/img/blog/setup-a-gitlab-ce-service/megan-fox.jpg" />
    
    
    <figcaption>
        <h4>Megan Fox</h4>
        
    </figcaption>
    
</figure>
</p>
         <div id="disqus_thread">
  <a href="#" onclick="disqus();return false;">enable VPN and click here to <i class="fa fa-comments" aria-hidden="true"></i></a>
</div>

<script type="text/javascript">
var disqus_loaded = false;
function disqus() {
  if (!disqus_loaded) {
    
    
    
    

    disqus_loaded = true;
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'wushuzh';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }
};
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>
    </div>
  </div>
</div>
<noscript>
  <style>.jsonly { display: none }</style>
</noscript>

          </div>
      </div>
  </div>
  <script src="https://wushuzh.github.io/js/jquery.min.js"></script>
<script src="https://wushuzh.github.io/js/bootstrap.min.js"></script>
<script src="https://wushuzh.github.io/js/jquery.cookie.js"> </script>
<script src="https://wushuzh.github.io/js/ekko-lightbox.js"></script>
<script src="https://wushuzh.github.io/js/jquery.scrollTo.min.js"></script>
<script src="https://wushuzh.github.io/js/masonry.pkgd.min.js"></script>
<script src="https://wushuzh.github.io/js/imagesloaded.pkgd.min.js"></script>
<script src="https://wushuzh.github.io/js/owl.carousel.min.js"></script>
<script src="https://wushuzh.github.io/js/front.js"></script>

<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</body>
</html>
