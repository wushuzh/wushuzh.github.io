<!DOCTYPE html>
<html lang="zh-cn">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>搞不懂报错信息，咋整？</title>
<meta name="description" content="个人技术站点">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="https://wushuzh.github.io/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="https://wushuzh.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="https://wushuzh.github.io/css/owl.carousel.css">
<link rel="stylesheet" href="https://wushuzh.github.io/css/owl.theme.css">


  <link href="https://wushuzh.github.io/css/style.sea.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://wushuzh.github.io/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://wushuzh.github.io/img/favicon.png">


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-102509506-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="/">小强会武术</a></h1>
    
      <p class="sidebar-p">工程师</p>
    
    <ul class="sidebar-menu">
      
      
        <li><a href="https://wushuzh.github.io/">Home</a></li>
      
    </ul>
    <p class="social">
  
  
  
  <a href="https://twitter.com/Xiao_Qiang" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  <a href="mailto:wushuzh@outlook.com" data-animate-hover="pulse" class="email">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  
  
  <a href="https://www.github.com/wushuzh" data-animate-hover="pulse">
    <i class="fa fa-github"></i>
  </a>
  

  
  <a href="https://wushuzh.github.io/index.xml" data-animate-hover="pulse">
    <i class='fa fa-rss'></i>
  </a>
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2017 wushuzh
        
        | Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="/">小强会武术</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>搞不懂报错信息，咋整？</h1>

         <div>
           <span class="pull-left">
             <i class="fa fa-calendar"></i>
             <time datetime="2017-06-30 19:19:19 &#43;0800 CST">2017-06-30</time>
             &middot;
             771 字
             &middot;
             2 分钟
           </span>
           <span class="pull-right">
             <div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwushuzh.github.io%2fblog%2f2017%2f06%2f30%2fdeal-with-wired-errmsgs%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=%e6%90%9e%e4%b8%8d%e6%87%82%e6%8a%a5%e9%94%99%e4%bf%a1%e6%81%af%ef%bc%8c%e5%92%8b%e6%95%b4%ef%bc%9f&amp;url=https%3a%2f%2fwushuzh.github.io%2fblog%2f2017%2f06%2f30%2fdeal-with-wired-errmsgs%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwushuzh.github.io%2fblog%2f2017%2f06%2f30%2fdeal-with-wired-errmsgs%2f&amp;title=%e6%90%9e%e4%b8%8d%e6%87%82%e6%8a%a5%e9%94%99%e4%bf%a1%e6%81%af%ef%bc%8c%e5%92%8b%e6%95%b4%ef%bc%9f"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fwushuzh.github.io%2fblog%2f2017%2f06%2f30%2fdeal-with-wired-errmsgs%2f&amp;title=%e6%90%9e%e4%b8%8d%e6%87%82%e6%8a%a5%e9%94%99%e4%bf%a1%e6%81%af%ef%bc%8c%e5%92%8b%e6%95%b4%ef%bc%9f"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=%e6%90%9e%e4%b8%8d%e6%87%82%e6%8a%a5%e9%94%99%e4%bf%a1%e6%81%af%ef%bc%8c%e5%92%8b%e6%95%b4%ef%bc%9f&amp;body=https%3a%2f%2fwushuzh.github.io%2fblog%2f2017%2f06%2f30%2fdeal-with-wired-errmsgs%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>

           </span>
         <br/>

         <p>别被报错信息带歪了方向……
</p>

<p>Lucy 的服务器才从内核恐慌中恢复过来，接着使用时又出现了另一个诡异错误。</p>

<p>服务器环境介绍 nfs default network and ovs
最简单的虚拟主机运行 ks console 运行
表面错误，查看日志，文件权限lsof，fuser，message，selinux
nfs 服务器设定，全部恢复</p>

<p>[jiaqianz@nio136 ~]$ tail -3 /etc/profile</p>

<p>export LIBVIRT_DEFAULT_URI=qemu:///system</p>

<p>qemu-img create -f qcow2 wushuzh.qcow2 10G</p>

<p>virt-install &ndash;name wushuzh  &ndash;vcpus=2 &ndash;ram 4096 &ndash;os-type=linux &ndash;os-variant rhel7 &ndash;disk /kvm/vmimg/wushuzh.qcow2,device=disk,bus=virtio  &ndash;location  /repo/isos/rhel-server-7.3-x86_64-dvd.iso &ndash;extra-args=&ldquo;ks=file:/wushuzh.ks console=tty0 console=ttyS0,115200n8&rdquo;  &ndash;network network:default &ndash;initrd-inject=wushuzh.ks  &ndash;nographics</p>

<pre><code>[jiaqianz@nio136 ~]$ cat wushuzh.ks
#version=DEVEL
# System authorization information
auth --enableshadow --passalgo=sha512
repo --name=&quot;Server-HighAvailability&quot; --baseurl=file:///run/install/repo/addons/HighAvailability
repo --name=&quot;Server-ResilientStorage&quot; --baseurl=file:///run/install/repo/addons/ResilientStorage
# Use CDROM installation media
cdrom
# Use graphical install
text

reboot

# Run the Setup Agent on first boot
firstboot --enable
ignoredisk --only-use=vda
# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=eth0 --ipv6=auto --activate
network  --hostname=wushuzh

# Root password
rootpw --iscrypted $6$af6GAwTRtyJ1pbha$6TWiQcMNB/H1ndamt5yl2wRI.VNe.G5XkepUOMiD6HBzdgydVJhQ.iXX4OGbzysek972zlsB8rfZLFz4yYaJK/
# System services
services --enabled=&quot;chronyd&quot;
# System timezone
timezone Asia/Shanghai --isUtc --ntpservers=135.242.109.14
# System bootloader configuration
bootloader --append=&quot; crashkernel=auto&quot; --location=mbr --boot-drive=vda
autopart --type=lvm
# Partition clearing information
clearpart --none --initlabel

%packages
@^minimal
@core
chrony
kexec-tools

%end

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end
</code></pre>

<p>[root@nio136 qemu]# pwd
/var/log/libvirt/qemu
[root@nio136 qemu]#
[root@nio136 qemu]#
[root@nio136 qemu]# tail -4 vmnio27.log
Domain id=28 is tainted: host-cpu
char device redirected to /dev/pts/11
2017-06-28T05:57:05.872745Z qemu-kvm: -drive file=/alcatel/releases/Linux_deliveries/iso/DVD1L_MS_F0001I2_kvm_Jiaqiang.iso_cksum_3063878201,if=none,media=cdrom,id=drive-ide0-1-0,readonly=on,format=raw: could not open disk image /alcatel/releases/Linux_deliveries/iso/DVD1L_MS_F0001I2_kvm_Jiaqiang.iso_cksum_3063878201: Permission denied
2017-06-28 05:57:06.188+0000: shutting down</p>

<p>Jun 28 13:57:13 nio136 setroubleshoot: SELinux is preventing /usr/libexec/qemu-kvm from read access on the lnk_file releases. For c
omplete SELinux messages. run sealert -l ccc9f19d-f2b2-4a1e-b991-af6de737f285</p>

<p>[root@nio136 log]# tail -3 /var/log/messages
Jun 28 13:57:13 nio136 setroubleshoot: SELinux is preventing /usr/libexec/qemu-kvm from read access on the lnk_file releases. For complete SELinux messages. run sealert -l ccc9f19d-f2b2-4a1e-b991-af6de737f285
Jun 28 14:13:28 nio136 dnsmasq-dhcp[10311]: DHCPREQUEST(virbr0) 192.168.122.129 52:54:00:c8:a8:76
Jun 28 14:13:28 nio136 dnsmasq-dhcp[10311]: DHCPACK(virbr0) 192.168.122.129 52:54:00:c8:a8:76 wushuzh</p>

<p>[root@nio136 log]# sealert -l ccc9f19d-f2b2-4a1e-b991-af6de737f285
PuTTY X11 proxy: Unsupported authorisation protocol
SELinux is preventing /usr/libexec/qemu-kvm from read access on the lnk_file releases.</p>

<p>*****  Plugin catchall_labels (83.8 confidence) suggests  ********************</p>

<p>If you want to allow qemu-kvm to have read access on the releases lnk_file
Then you need to change the label on releases
Do</p>

<h1 id="semanage-fcontext-a-t-file-type-releases">semanage fcontext -a -t FILE_TYPE &lsquo;releases&rsquo;</h1>

<p>where FILE_TYPE is one of the following: proc_t, mnt_t, usr_t, user_home_type, virt_etc_rw_t, textrel_shlib_t, rpm_script_tmp_t, home_root_t, configfile, user_home_dir_t, cert_type, device_t, configfile, sysfs_t, sssd_var_lib_t, virt_var_lib_t, virt_var_run_t, svirt_t, qemu_var_run_t, svirt_tmp_t, virt_content_t, public_content_t, public_content_rw_t, device_t, abrt_t, etc_t, ld_so_t, proc_t, lib_t, sysfs_t, root_t, svirt_image_t, svirt_tmpfs_t, virt_image_t, user_home_t, usr_t, base_ro_file_type, userdomain, device_t, devlog_t, locale_t, etc_t, bin_t, sysfs_t, sysfs_t, usbfs_t.
Then execute:
restorecon -v &lsquo;releases&rsquo;</p>

<p>*****  Plugin catchall (17.1 confidence) suggests  ***************************</p>

<p>If you believe that qemu-kvm should be allowed read access on the releases lnk_file by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access for now by executing:</p>

<h1 id="grep-qemu-kvm-var-log-audit-audit-log-audit2allow-m-mypol">grep qemu-kvm /var/log/audit/audit.log | audit2allow -M mypol</h1>

<h1 id="semodule-i-mypol-pp">semodule -i mypol.pp</h1>

<p>Additional Information:
Source Context                system_u:system_r:svirt_t:s0:c282,c505
Target Context                system_u:object_r:default_t:s0
Target Objects                releases [ lnk_file ]
Source                        qemu-kvm
Source Path                   /usr/libexec/qemu-kvm
Port                          <Unknown>
Host                          nio136
Source RPM Packages           qemu-kvm-0.12.1.2-2.503.el6_9.3.x86_64
Target RPM Packages
Policy RPM                    selinux-policy-3.7.19-307.el6.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     nio136
Platform                      Linux nio136 2.6.32-696.3.2.el6.centos.plus.x86_64
                              #1 SMP Tue Jun 20 08:34:26 UTC 2017 x86_64 x86_64
Alert Count                   2
First Seen                    Wed 28 Jun 2017 01:57:05 PM CST
Last Seen                     Wed 28 Jun 2017 01:57:05 PM CST
Local ID                      ccc9f19d-f2b2-4a1e-b991-af6de737f285</p>

<p>Raw Audit Messages
type=AVC msg=audit(1498629425.872:3540): avc:  denied  { read } for  pid=11332 comm=&ldquo;qemu-kvm&rdquo; name=&ldquo;releases&rdquo; dev=sdd3 ino=1572866 scontext=system_u:system_r:svirt_t:s0:c282,c505 tcontext=system_u:object_r:default_t:s0 tclass=lnk_file</p>

<p>type=SYSCALL msg=audit(1498629425.872:3540): arch=x86_64 syscall=open success=no exit=EACCES a0=7f255606c6c0 a1=81000 a2=0 a3=40 items=0 ppid=1 pid=11332 auid=4294967295 uid=107 gid=107 euid=107 suid=107 fsuid=107 egid=107 sgid=107 fsgid=107 tty=(none) ses=4294967295 comm=qemu-kvm exe=/usr/libexec/qemu-kvm subj=system_u:system_r:svirt_t:s0:c282,c505 key=(null)</p>

<p>Hash: qemu-kvm,svirt_t,default_t,lnk_file,read</p>

<p>audit2allow</p>

<p>#============= svirt_t ==============
allow svirt_t default_t:lnk_file read;</p>

<p>audit2allow -R</p>

<p>#============= svirt_t ==============
allow svirt_t default_t:lnk_file read;</p>

<p>[jiaqianz@nio136 ~]$ showmount -e localhost
Export list for localhost:
/var/lib/tftpboot/linux-install/DVD1L_MS_E0003.iso.cksum_4003358163                135.252.169.0/24
/var/lib/tftpboot/linux-install/DVD1L_MS_F0006.iso.cksum_2458033891                135.252.169.0/24
/var/lib/tftpboot/linux-install/DVD1L_MS_K0002.iso.cksum_2397322682                135.252.169.0/24
/var/lib/tftpboot/linux-install/DVD1L_MS_G0013.iso.cksum_3418817510                135.252.169.0/24
/var/lib/tftpboot/linux-install/DVD1L_MS_K0004.iso.cksum_536112348                 135.252.169.0/24
/var/lib/tftpboot/linux-install/DVD1L_MS_E0001.iso.cksum_3613805171                135.252.169.0/24
/var/lib/tftpboot/linux-install/DVD1L_MS_RH7_0012I2.iso.cksum_2392312393           135.252.169.0/24</p>

<p>缩略语解释
&gt; -</p>

<p>参考文档
&gt; - <a href="http://cn.linux.vbird.org/linux_server/0330nfs_2.php">http://cn.linux.vbird.org/linux_server/0330nfs_2.php</a>
&gt; - <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/ap-rescuemode.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/ap-rescuemode.html</a>
&gt; - <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Installation_Guide/chap-basic-system-recovery.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Installation_Guide/chap-basic-system-recovery.html</a></p>

<blockquote>
<ul>
<li><a href="https://www.centos.org/forums/viewtopic.php?t=18457">https://www.centos.org/forums/viewtopic.php?t=18457</a></li>
<li><a href="https://bugs.launchpad.net/nova/+bug/1255624">https://bugs.launchpad.net/nova/+bug/1255624</a></li>
<li><a href="https://superuser.com/questions/97844/how-can-i-determine-what-process-has-a-file-open-in-linux">https://superuser.com/questions/97844/how-can-i-determine-what-process-has-a-file-open-in-linux</a></li>
<li><a href="http://www.thegeekstuff.com/2012/08/lsof-command-examples/">http://www.thegeekstuff.com/2012/08/lsof-command-examples/</a></li>
<li><a href="https://www.cyberciti.biz/faq/howto-linux-get-list-of-open-files/">https://www.cyberciti.biz/faq/howto-linux-get-list-of-open-files/</a></li>
<li><a href="https://www.cyberciti.biz/faq/how-to-linux-re-apply-or-restore-selinux-security-labels-context/">https://www.cyberciti.biz/faq/how-to-linux-re-apply-or-restore-selinux-security-labels-context/</a></li>
<li><a href="http://cn.linux.vbird.org/linux_server/0210network-secure_4.php">http://cn.linux.vbird.org/linux_server/0210network-secure_4.php</a></li>
</ul>
</blockquote>

<p>封面图片来自 <a href="https://dribbble.com/shots/1606433-I-m-a-computa">I&rsquo;m a computa</a> <a href="https://dribbble.com/Tymn"><i class="fa fa-dribbble" aria-hidden="true"></i> Tymn Armstrong</a></p>

<p>其他图片来源网络</p>
         <div id="disqus_thread">
  <a href="#" onclick="disqus();return false;">Show Comments</a>
</div>

<script type="text/javascript">
var disqus_loaded = false;
function disqus() {
  if (!disqus_loaded) {
    
    
    
    

    disqus_loaded = true;
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'wushuzh';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }
};
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>
    </div>
  </div>
</div>
<noscript>
  <style>.jsonly { display: none }</style>
</noscript>

          </div>
      </div>
  </div>
  <script src="https://wushuzh.github.io/js/jquery.min.js"></script>
<script src="https://wushuzh.github.io/js/bootstrap.min.js"></script>
<script src="https://wushuzh.github.io/js/jquery.cookie.js"> </script>
<script src="https://wushuzh.github.io/js/ekko-lightbox.js"></script>
<script src="https://wushuzh.github.io/js/jquery.scrollTo.min.js"></script>
<script src="https://wushuzh.github.io/js/masonry.pkgd.min.js"></script>
<script src="https://wushuzh.github.io/js/imagesloaded.pkgd.min.js"></script>
<script src="https://wushuzh.github.io/js/owl.carousel.min.js"></script>
<script src="https://wushuzh.github.io/js/front.js"></script>

<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</body>
</html>
