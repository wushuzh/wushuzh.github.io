<!DOCTYPE html>
<html lang="zh-cn">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>ARTS 2018w31</title>
<meta name="description" content="个人技术站点">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="https://wushuzh.github.io/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="https://wushuzh.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="https://wushuzh.github.io/css/owl.carousel.css">
<link rel="stylesheet" href="https://wushuzh.github.io/css/owl.theme.css">


  <link href="https://wushuzh.github.io/css/style.sea.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://wushuzh.github.io/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://wushuzh.github.io/img/favicon.png">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-102509506-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              
              
<div class="col-xs-12 col-sm-12 col-md-12 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="https://wushuzh.github.io/">小强会武术</a></h1>
</div>

  <div class="row">
    <div class="col-lg-10 col-lg-offset-1">
      <div class="content-column-content">
      
      <div class="row">
        <div class="col-sm-4">
          
            <div class="image">
              <img src="https://wushuzh.github.io//img/blog/arts-05-per-week/chaos.gif" class="img-responsive" alt="">
            </div>
          
        </div>
        <div class="col-md-6">
            <h2>ARTS 2018w31</h2>
                <p>
                  <i class="fa fa-share-square-o fa-fw"></i><a href="/"> 小强会武术</a>
                </p>

                <p>
                <time datetime="2018-08-01 23:05:11 &#43;0800 CST">
                <i class="fa fa-calendar-o fa-fw"></i> 2018-08-01
                </time>
                &middot;
                2112 字
                &middot;
                5 分钟
                </p>

                
                <p>
                  <i class="fa fa-tags fa-fw" aria-hidden="true"></i>
                  <a href="/tags/arts">ARTS</a> &nbsp;&nbsp; <a href="/tags/test">test</a> &nbsp;&nbsp; <a href="/tags/tools">tools</a>
                </p>
                

        </div>
      </div>
      <br />

         <p>找一个“杠精”帮助你设计、执行测试</p>

<h2 id="algorithm">Algorithm</h2>

<p>本周 leetocode 题目 <a href="https://leetcode.com/problems/two-sum/description/">1. Two Sum</a> 返回数组中的两个元素索引位置，使得他们的和为指定值(原数组中一定有解且唯一）。</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">twoSum</span>(nums, target):
    buff_dict <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(nums)):
        <span style="color:#66d9ef">if</span> nums[i] <span style="color:#f92672">in</span> buff_dict:
            <span style="color:#66d9ef">return</span> [buff_dict[nums[i]], i]
        <span style="color:#66d9ef">else</span>:
            buff_dict[target <span style="color:#f92672">-</span> nums[i]] <span style="color:#f92672">=</span> i</code></pre></div>

<p>关键在于利用 dict 设计一个缓存，一方面保存待寻找的另一个加数，另一方面同时保存当前加数的索引位置。</p>

<p>测试用例</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_two_sum</span>(random_chk<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>):
    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(random_chk):
        len_a <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">100</span>)
        input_a <span style="color:#f92672">=</span> [randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(len_a)]

        m <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">60</span>)
        n <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">80</span>)

        m_idx <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">0</span>, len_a)
        n_idx <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">0</span>, len_a)

        input_a<span style="color:#f92672">.</span>insert(m_idx, m)
        input_a<span style="color:#f92672">.</span>insert(n_idx, n)

        <span style="color:#66d9ef">if</span> m_idx <span style="color:#f92672">&gt;=</span> n_idx:
            m_idx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

        i, j <span style="color:#f92672">=</span> two_sum(input_a, m <span style="color:#f92672">+</span> n)
        <span style="color:#66d9ef">assert</span> input_a[i] <span style="color:#f92672">+</span> input_a[j] <span style="color:#f92672">==</span> m <span style="color:#f92672">+</span> n
        <span style="color:#66d9ef">assert</span> {i, j} <span style="color:#f92672">==</span> {m_idx, n_idx}</code></pre></div>
<br/></p>

<h2 id="review">Review</h2>

<p>本周读了来自 Thomas Guest &ldquo;Word Aligned&rdquo; 上的两篇文章:</p>

<ul>
<li>第一篇 <a href="http://wordaligned.org/articles/slicing-a-list-evenly-with-python">Slicing a list evenly with Python</a> (2017-5-14)  一步步地实现如何将一个列表尽可能的做 n 等分;</li>
<li>第二篇 <a href="http://wordaligned.org/articles/unleash-the-test-army">Unleash the test army</a> (2017-05-29) 则利用 python 的 hypothesis 模块对上面的解法进行测试;</li>
</ul>

<h3 id="初始解法">初始解法</h3>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chunk</span>(xs, n):
    <span style="color:#e6db74">&#39;&#39;&#39;Split the list, xs, into n chunks
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    L <span style="color:#f92672">=</span> len(xs)
    <span style="color:#66d9ef">assert</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;</span> n <span style="color:#f92672">&lt;=</span> L
    s <span style="color:#f92672">=</span> L<span style="color:#f92672">//</span>n
    <span style="color:#66d9ef">return</span> [xs[p:p<span style="color:#f92672">+</span>s] <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, L, s)]</code></pre></div>

<p>这个解法在当 xs 的长度 L 不是 n 的整数倍时，会得到 <strong>n + 1</strong> 个或 <strong>L</strong> 个片段(当 L // n == 1 且 L % n != 0 时 ）。</p>

<h3 id="改进解法">改进解法</h3>

<p>尝试修复的算法如下——即将剩余元素放入最后一个 chunk</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chunk</span>(xs, n):
    <span style="color:#e6db74">&#39;&#39;&#39;Split the list, xs, into n chunks
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    L <span style="color:#f92672">=</span> len(xs)
    <span style="color:#66d9ef">assert</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;</span> n <span style="color:#f92672">&lt;=</span> L
    s, r <span style="color:#f92672">=</span> divmod(L, n)
    chunks <span style="color:#f92672">=</span> [xs[p:p<span style="color:#f92672">+</span>s] <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, L, s)]
    chunks[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:] <span style="color:#f92672">=</span> [xs[<span style="color:#f92672">-</span>r<span style="color:#f92672">-</span>s:]]
    <span style="color:#66d9ef">return</span> chunks</code></pre></div>

<p>但问题是这样一来元素分布就不平均了——最后一段总是多出 r 个元素。</p>

<p>一种解决办法是生成 <strong>r</strong> 个含有 s + 1 个元素的片段，以及 <strong>n - r</strong> 个含 s 个元素的片段</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chunk</span>(xs, n):
    <span style="color:#e6db74">&#39;&#39;&#39;Split the list, xs, into n chunks
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    L <span style="color:#f92672">=</span> len(xs)
    <span style="color:#66d9ef">assert</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;</span> n <span style="color:#f92672">&lt;=</span> L
    s, r <span style="color:#f92672">=</span> divmod(L, n)
    t <span style="color:#f92672">=</span> s <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">return</span> ([xs[p:p<span style="color:#f92672">+</span>t] <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, r<span style="color:#f92672">*</span>t, t)] <span style="color:#f92672">+</span>
            [xs[p:p<span style="color:#f92672">+</span>s] <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> range(r<span style="color:#f92672">*</span>t, L, s)])</code></pre></div>

<h3 id="传统测试">传统测试</h3>

<p>然后是一些一般意义上的测试用例。
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_chunk</span>():
    <span style="color:#66d9ef">with</span> pytest<span style="color:#f92672">.</span>raises(<span style="color:#a6e22e">AssertionError</span>):
        <span style="color:#66d9ef">assert</span> chunk(<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> [<span style="color:#e6db74">&#39;&#39;</span>]
    <span style="color:#66d9ef">assert</span> chunk(<span style="color:#e6db74">&#39;ab&#39;</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">==</span> [<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>]
    <span style="color:#66d9ef">assert</span> chunk(<span style="color:#e6db74">&#39;abc&#39;</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">==</span> [<span style="color:#e6db74">&#39;ab&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>]
    
    xs <span style="color:#f92672">=</span> list(range(<span style="color:#ae81ff">8</span>))
    <span style="color:#66d9ef">assert</span> chunk(xs, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">==</span> [[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>], [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>]]
    <span style="color:#66d9ef">assert</span> chunk(xs, <span style="color:#ae81ff">3</span>) <span style="color:#f92672">==</span> [[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>], [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>], [<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>]]
    <span style="color:#66d9ef">assert</span> chunk(xs, <span style="color:#ae81ff">5</span>) <span style="color:#f92672">==</span> [[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>], [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>], [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>], [<span style="color:#ae81ff">6</span>], [<span style="color:#ae81ff">7</span>]]
    
    rs <span style="color:#f92672">=</span> range(<span style="color:#ae81ff">1000000</span>)
    <span style="color:#66d9ef">assert</span> chunk(rs, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">==</span> [range(<span style="color:#ae81ff">500000</span>), range(<span style="color:#ae81ff">500000</span>, <span style="color:#ae81ff">1000000</span>)]</code></pre></div></p>

<h3 id="新派-测试">“新派”测试</h3>

<p>但上面这些测试用例的特点是因人而异。但如果是我们只负责描述被测系统的属性，然后测试工具按照这些约束“召唤”出千奇百怪的输入，再看被测系统能否禁受的住的这样的自动测试大军的冲击。</p>

<p>这主意听起来不错，但这个“智能”的测试工具/框架能否达到预期效果依然存疑，但同样的，我们也该对传统测试集的完备性同样存疑……幸好 python 的 hypothesis 开了一个不错的头。</p>

<p>回到本题目的基础约束：</p>

<ul>
<li>最后分好的段的数量为 n</li>
<li>各段长度不能参差不齐，要么全一样，要么一大一小（仅相差1）</li>
</ul>

<p>委托 hypothesis 提供满足上述约束的输入测试集:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> hypothesis <span style="color:#f92672">as</span> ht
<span style="color:#f92672">import</span> hypothesis.strategies <span style="color:#f92672">as</span> st

<span style="color:#a6e22e">@ht.given</span>(xs<span style="color:#f92672">=</span>st<span style="color:#f92672">.</span>lists(), n<span style="color:#f92672">=</span>st<span style="color:#f92672">.</span>integers())
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_evenly_chunked</span>(xs, n):
    chunks <span style="color:#f92672">=</span> chunk(xs, n)
    <span style="color:#66d9ef">assert</span> len(chunks) <span style="color:#f92672">==</span> n
    chunk_lens <span style="color:#f92672">=</span> {len(c) <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> chunks}
    <span style="color:#66d9ef">assert</span> len(chunk_lens) <span style="color:#f92672">in</span> {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>}
    <span style="color:#66d9ef">assert</span> max(chunk_lens) <span style="color:#f92672">-</span> min(chunk_lens) <span style="color:#f92672">in</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>}</code></pre></div>

<p>然而函数在测试某些“犄角旮旯”的用例时报错：</p>

<ul>
<li>将 xs 设为空列表</li>
<li>将 n 设为 0</li>
</ul>

<p>这时作者做了如下几个设计上的选择：</p>

<ol>
<li>不再通过产生运行时的 AssertionError 对输入参数做合法性判定</li>
<li>要支持 n &gt; L 的情况</li>
<li>不需要支持 n == 0 ，即便 xs 为空列表</li>
</ol>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@ht.given</span>(xs<span style="color:#f92672">=</span>st<span style="color:#f92672">.</span>lists(st<span style="color:#f92672">.</span>integers()),
          n<span style="color:#f92672">=</span>st<span style="color:#f92672">.</span>integers(min_value<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_evenly_chunked</span>(xs, n):
    chunks <span style="color:#f92672">=</span> chunk(xs, n)
    <span style="color:#75715e"># Same assert code as previous</span></code></pre></div>

<h3 id="终极解法">终极解法</h3>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> itertools <span style="color:#f92672">import</span> accumulate, chain, repeat, tee

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chunk</span>(xs, n):
    <span style="color:#e6db74">&#39;&#39;&#39;Split the list, xs, into n evenly sized chunks&#39;&#39;&#39;</span>
    <span style="color:#66d9ef">assert</span> n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>
    L <span style="color:#f92672">=</span> len(xs)
    s, r <span style="color:#f92672">=</span> divmod(L, n)
    widths <span style="color:#f92672">=</span> chain(repeat(s<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, r), repeat(s, n<span style="color:#f92672">-</span>r))
    offsets <span style="color:#f92672">=</span> accumulate(chain((<span style="color:#ae81ff">0</span>,), widths))
    b, e <span style="color:#f92672">=</span> tee(offsets)
    next(e)
    <span style="color:#66d9ef">return</span> [xs[s] <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> map(slice, b, e)]</code></pre></div>

<p>再次运行测试时 hypothesis 在模拟 n 特别大的情况时，因为需要太多资源，函数无法中止。</p>

<h3 id="终极测试">终极测试</h3>

<p>解决方式一种是将原函数改为 python generator ，另一种方式认为这种情况不应该发生，约束 hypothesis 测试时不产生过大的 n 。</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@ht.given</span>(xs<span style="color:#f92672">=</span>st<span style="color:#f92672">.</span>one_of(st<span style="color:#f92672">.</span>text(),
                       st<span style="color:#f92672">.</span>binary(),
                       st<span style="color:#f92672">.</span>lists(st<span style="color:#f92672">.</span>integers())),
          n<span style="color:#f92672">=</span>st<span style="color:#f92672">.</span>integers(min_value<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, max_value<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>))
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_evenly_chunked</span>(xs, n):
    chunks <span style="color:#f92672">=</span> chunk(xs, n)
    <span style="color:#75715e"># Same assert code as previous</span></code></pre></div>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> functools

<span style="color:#f92672">import</span> hypothesis <span style="color:#f92672">as</span> ht
<span style="color:#f92672">import</span> hypothesis.strategies <span style="color:#f92672">as</span> st

<span style="color:#a6e22e">@st.composite</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">items_and_chunk_count</span>(draw):
    xs <span style="color:#f92672">=</span> draw(st<span style="color:#f92672">.</span>one_of(st<span style="color:#f92672">.</span>text(),
                        st<span style="color:#f92672">.</span>binary(),
                        st<span style="color:#f92672">.</span>lists(st<span style="color:#f92672">.</span>integers())))
    n <span style="color:#f92672">=</span> draw(st<span style="color:#f92672">.</span>integers(min_value<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
                         max_value<span style="color:#f92672">=</span>max(<span style="color:#ae81ff">1</span>, len(xs))))
    <span style="color:#66d9ef">return</span> xs, n

<span style="color:#a6e22e">@ht.given</span>(xs_n<span style="color:#f92672">=</span>items_and_chunk_count())
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_evenly_chunked</span>(xs_n):
    <span style="color:#e6db74">&#39;&#39;&#39;Verify there are n evenly sized chunks&#39;&#39;&#39;</span>
    xs, n <span style="color:#f92672">=</span> xs_n
    chunks <span style="color:#f92672">=</span> chunk(xs, n)
    <span style="color:#66d9ef">assert</span> len(chunks) <span style="color:#f92672">==</span> n
    chunk_lens <span style="color:#f92672">=</span> {len(c) <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> chunks}
    <span style="color:#66d9ef">assert</span> len(chunk_lens) <span style="color:#f92672">in</span> {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>}
    <span style="color:#66d9ef">assert</span> max(chunk_lens) <span style="color:#f92672">-</span> min(chunk_lens) <span style="color:#f92672">in</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>}

<span style="color:#a6e22e">@ht.given</span>(xs_n<span style="color:#f92672">=</span>items_and_chunk_count())
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_combining_chunks</span>(xs_n):
    <span style="color:#e6db74">&#39;&#39;&#39;Verify recombining the chunks reproduces the original sequence.&#39;&#39;&#39;</span>
    xs, n <span style="color:#f92672">=</span> xs_n
    chunks <span style="color:#f92672">=</span> chunk(xs, n)
    <span style="color:#66d9ef">assert</span> functools<span style="color:#f92672">.</span>reduce(<span style="color:#66d9ef">lambda</span> x, y: x<span style="color:#f92672">+</span>y, chunks) <span style="color:#f92672">==</span> xs</code></pre></div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">λ pipenv run pytest --hypothesis-show-statistics
=================== test session starts ===================
platform win32 -- Python 3.6.5, pytest-3.7.1, py-1.5.4, pluggy-0.7.1
rootdir: ~\code\leetcode\slicing_a_list_evenly, inifile:
plugins: cov-2.5.1, hypothesis-3.66.23
collected 3 items

test_solution.py ...                                                     [100%]
================== Hypothesis Statistics ==================

test_solution.py::test_evenly_chunked:

  - 100 passing examples, 0 failing examples, 0 invalid examples
  - Typical runtimes: 0-15 ms
  - Fraction of time spent in data generation: ~ 40%
  - Stopped because settings.max_examples=100

test_solution.py::test_combining_chunks:

  - 100 passing examples, 0 failing examples, 0 invalid examples
  - Typical runtimes: 0-16 ms
  - Fraction of time spent in data generation: ~ 54%
  - Stopped because settings.max_examples=100

================ 3 passed in 0.93 seconds =================</code></pre></div></p>

<p>总结下来:</p>

<ul>
<li>强制我们去思考确认被测对象的规范</li>
<li>产生各种作者可能想不到的逻辑上合规的输入，测试被测对象的行为</li>
<li>测试和具体实现最低程度的耦合，方便代码重构——用完全不同的思路重新实现需求</li>
</ul>

<p>基于特性的测试(property based testing)和基于示例的测试(example based testing)互为补充。虽然前者在设置数据生成策略和定义系统约束上会很困难，但这仍值得尝试。</p>

<p>就像 Hypothesis 作者说的那样：“人们都说，软件正在吞噬世界。但同时软件也糟透了，富含 bug、冲动而危险、禁不起太多的思考推敲——这一切相互作用泡制出一口灾难火锅。而软件测试的现状更糟，扪心自问，我们开发的系统有多少是经过充足测试的？写出好的测试非常难，一个重要原因是你基于你当初写代码时脑中的假设/谬误写出这些测试，所以他们测不出问题。”
<br/></p>

<h2 id="tip">Tip</h2>

<p>有时候希望对电脑中播放的媒体进行录音，利用 Windows 的 WASAPI (Windows Audio Session API) 特性配合 Audacity 一起完成。试了一下，效果还不错。具体操作见 Chris Hoffman (2017-10-24) <a href="https://www.howtogeek.com/217348/how-to-record-the-sound-coming-from-your-pc-even-without-stereo-mix/">How to Record the Sound Coming From Your PC (Even Without Stereo Mix)</a></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">choco install audacity
choco install audacity-lame</code></pre></div>

<p>对于录屏，CamStudio 处于濒死的状态？而 Active Presenter 看上去值得尝试。</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">choco install activepresenter</code></pre></div>
<br/></p>

<h2 id="share">Share</h2>

<p>上文提到的分割问题: 如果不考虑对元素做连续分割——本来题目中也没有要求这一点——那么会有非常简单优雅的解决算法：</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chunk</span>(xs,n):
    <span style="color:#66d9ef">return</span> [xs[index::n] <span style="color:#66d9ef">for</span> index <span style="color:#f92672">in</span> range(n)]</code></pre></div>

<p>但是上面的 <code>test_combining_chunks</code> 需要做相应改动。</p>

<p>或者说如果你熟悉 numpy ，直接使用 np.array_split 则根本不需要重新造轮：</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> numpy <span style="color:#f92672">import</span> array_split <span style="color:#66d9ef">as</span> chunk
<span style="color:#f92672">&gt;&gt;&gt;</span> xs <span style="color:#f92672">=</span> list(<span style="color:#e6db74">&#39;ab&#39;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> chunk(xs, <span style="color:#ae81ff">5</span>)
[array([<span style="color:#e6db74">&#39;a&#39;</span>], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;|S1&#39;</span>), array([<span style="color:#e6db74">&#39;b&#39;</span>], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;|S1&#39;</span>), array([], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;|S1&#39;</span>), array([], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;|S1&#39;</span>), array([], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;|S1&#39;</span>)]</code></pre></div>

<p>之前的一通操作和学习可谓是“在平坦的路上曲折前行了”，但下面的“坑”也应该“填平”:</p>

<ol>
<li>找到 np.array_split 的源码，看人家是如何实现的</li>
<li>通过压力测试比较上述几种实现的执行效率</li>
<li>以往做过的 leetcode 的题目是否可以用 hypothesis 进行测试</li>
</ol>

<p><br/></p>

<h2 id="拓展阅读">拓展阅读</h2>

<p>Thomas Guest @ Word Aligned</p>

<blockquote>
<ul>
<li>(2007-11-20) <a href="http://wordaligned.org/articles/zippy-triples-served-with-python">Zippy triples served with Python</a></li>
<li>(2016-3-21) <a href="http://wordaligned.org/articles/sausages-slices">Sausages, sausages, sausages - slice, slice, slice</a></li>
</ul>
</blockquote>

<p>ScottW</p>

<blockquote>
<ul>
<li>(2014-12-01) <a href="https://fsharpforfunandprofit.com/posts/property-based-testing/">An introduction to property-based testing</a></li>
<li>(2014-12-12) <a href="https://fsharpforfunandprofit.com/posts/property-based-testing-2/">Choosing properties for property-based testing</a></li>
</ul>
</blockquote>

<p>封面图片来自 <a href="https://dribbble.com/shots/1840925-Chaos-Reigns">Chaos Reigns</a> <a href="https://dribbble.com/bushra"><i class="fa fa-dribbble" aria-hidden="true"></i> Bushra Mahmood</a></p>
         <div id="disqus_thread">
  <a href="#" onclick="disqus();return false;"> 点击启用 Disqus 评论文章 <i class="fa fa-comments" aria-hidden="true"></i></a>
</div>

<script type="text/javascript">
var disqus_loaded = false;
function disqus() {
  if (!disqus_loaded) {
    
    
    
    

    disqus_loaded = true;
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'wushuzh';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }
};
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>
    </div>
  </div>
</div>
<noscript>
  <style>.jsonly { display: none }</style>
</noscript>

          </div>
      </div>
  </div>
  <script src="https://wushuzh.github.io/js/jquery.min.js"></script>
<script src="https://wushuzh.github.io/js/bootstrap.min.js"></script>
<script src="https://wushuzh.github.io/js/jquery.cookie.js"> </script>
<script src="https://wushuzh.github.io/js/ekko-lightbox.js"></script>
<script src="https://wushuzh.github.io/js/jquery.scrollTo.min.js"></script>
<script src="https://wushuzh.github.io/js/masonry.pkgd.min.js"></script>
<script src="https://wushuzh.github.io/js/imagesloaded.pkgd.min.js"></script>
<script src="https://wushuzh.github.io/js/owl.carousel.min.js"></script>
<script src="https://wushuzh.github.io/js/front.js"></script>

<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</body>
</html>
